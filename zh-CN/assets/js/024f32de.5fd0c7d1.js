"use strict";(self.webpackChunkadguard_dns_knowledge_base=self.webpackChunkadguard_dns_knowledge_base||[]).push([[948],{4137:function(e,t,a){a.d(t,{Zo:function(){return d},kt:function(){return k}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=n.createContext({}),s=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},d=function(e){var t=s(e.components);return n.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=s(a),k=r,m=c["".concat(p,".").concat(k)]||c[k]||u[k]||i;return a?n.createElement(m,o(o({ref:t},d),{},{components:a})):n.createElement(m,o({ref:t},d))}));function k(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=c;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var s=2;s<i;s++)o[s]=a[s];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},1459:function(e,t,a){a.r(t),a.d(t,{assets:function(){return d},contentTitle:function(){return p},default:function(){return k},frontMatter:function(){return l},metadata:function(){return s},toc:function(){return u}});var n=a(3117),r=a(102),i=(a(7294),a(4137)),o=["components"],l={title:"\u6982\u89c8",sidebar_position:1,toc_min_heading_level:2,toc_max_heading_level:3},p=void 0,s={unversionedId:"private-dns/api/overview",id:"private-dns/api/overview",title:"\u6982\u89c8",description:"\x3c!--",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/private-dns/api/overview.md",sourceDirName:"private-dns/api",slug:"/private-dns/api/overview",permalink:"/KnowledgeBaseDNS/zh-CN/private-dns/api/overview",draft:!1,editUrl:"https://github.com/AdguardTeam/KnowledgeBaseDNS/edit/master/docs/private-dns/api/overview.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"\u6982\u89c8",sidebar_position:1,toc_min_heading_level:2,toc_max_heading_level:3},sidebar:"sidebar",previous:{title:"\u6982\u89c8",permalink:"/KnowledgeBaseDNS/zh-CN/private-dns/overview"},next:{title:"Reference",permalink:"/KnowledgeBaseDNS/zh-CN/private-dns/api/reference"}},d={},u=[{value:"Authentication",id:"authentication",level:2},{value:"\u751f\u6210\u8bbf\u95ee\u4ee4\u724c",id:"\u751f\u6210\u8bbf\u95ee\u4ee4\u724c",level:3},{value:"\u793a\u4f8b\u8bf7\u6c42",id:"\u793a\u4f8b\u8bf7\u6c42",level:4},{value:"\u793a\u4f8b\u54cd\u5e94",id:"\u793a\u4f8b\u54cd\u5e94",level:4},{value:"\u5237\u65b0\u4ee5\u751f\u6210\u8bbf\u95ee\u4ee4\u724c",id:"\u5237\u65b0\u4ee5\u751f\u6210\u8bbf\u95ee\u4ee4\u724c",level:3},{value:"\u793a\u4f8b\u8bf7\u6c42",id:"\u793a\u4f8b\u8bf7\u6c42-1",level:4},{value:"\u793a\u4f8b\u54cd\u5e94",id:"\u793a\u4f8b\u54cd\u5e94-1",level:4},{value:"\u79fb\u9664\u5237\u65b0\u4ee4\u724c",id:"\u79fb\u9664\u5237\u65b0\u4ee4\u724c",level:3},{value:"\u8bf7\u6c42\u793a\u4f8b",id:"\u8bf7\u6c42\u793a\u4f8b",level:4},{value:"Authorization endpoint",id:"authorization-endpoint",level:3},{value:"\u8bbf\u95eeAPI",id:"\u8bbf\u95eeapi",level:3},{value:"API",id:"api",level:2},{value:"Reference",id:"reference",level:3},{value:"\u5f00\u6e90API \u89c4\u8303",id:"\u5f00\u6e90api-\u89c4\u8303",level:3},{value:"Changelog",id:"changelog",level:3},{value:"Feedback",id:"feedback",level:2}],c={toc:u};function k(e){var t=e.components,a=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"AdGuard DNS\u63d0\u4f9b\u4e86\u4e00\u4e2a REST API\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u5b83\u96c6\u6210\u5728\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\u3002"),(0,i.kt)("h2",{id:"authentication"},"Authentication"),(0,i.kt)("h3",{id:"\u751f\u6210\u8bbf\u95ee\u4ee4\u724c"},"\u751f\u6210\u8bbf\u95ee\u4ee4\u724c"),(0,i.kt)("p",null,"Make a POST request for the following URL with the given params to generate the ",(0,i.kt)("inlineCode",{parentName:"p"},"access_token"),":"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"https://api.adguard-dns.io/oapi/v1/oauth_token")),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"left"},"Parameter"),(0,i.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("strong",{parentName:"td"},"username")),(0,i.kt)("td",{parentName:"tr",align:"left"},"Account email")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("strong",{parentName:"td"},"password")),(0,i.kt)("td",{parentName:"tr",align:"left"},"Account password")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"mfa_token"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Two-Factor authentication token (if enabled in account settings)")))),(0,i.kt)("p",null,"\u5728\u54cd\u5e94\u4e2d\uff0c\u60a8\u5c06\u540c\u65f6\u83b7\u5f97 ",(0,i.kt)("inlineCode",{parentName:"p"},"access_token")," \u548c ",(0,i.kt)("inlineCode",{parentName:"p"},"refresh_token"),"\u3002"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"access_token")," \u5c06\u5728\u6307\u5b9a\u7684\u51e0\u79d2\u540e\u8fc7\u671f\uff08\u7531\u54cd\u5e94\u4e2d\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"expires_in")," \u53c2\u6570\u51b3\u5b9a\uff09 \u60a8\u53ef\u4ee5\u91cd\u65b0\u751f\u6210\u4e00\u4e2a\u65b0\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"access_token")," \u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"refresh_token"),"\uff08\u53c2\u8003\uff1a",(0,i.kt)("inlineCode",{parentName:"p"},"Generate Access Token from Refresh Token"),"\uff09\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"refresh_token")," \u662f\u6c38\u4e45\u6027\u7684\u3002 \u8981\u64a4\u9500 ",(0,i.kt)("inlineCode",{parentName:"p"},"refresh_token"),"\uff0c\u8bf7\u53c2\u9605\uff1a",(0,i.kt)("inlineCode",{parentName:"p"},"Revoking a Refresh Token"),"\u3002"))),(0,i.kt)("h4",{id:"\u793a\u4f8b\u8bf7\u6c42"},"\u793a\u4f8b\u8bf7\u6c42"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"$ curl 'https://api.adguard-dns.io/oapi/v1/oauth_token' -i -X POST \\\n    -H 'Content-Type: application/x-www-form-urlencoded' \\\n    -d 'username=user%40adguard.com' \\\n    -d 'password=********' \\\n    -d 'mfa_token=727810'\n")),(0,i.kt)("h4",{id:"\u793a\u4f8b\u54cd\u5e94"},"\u793a\u4f8b\u54cd\u5e94"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "access_token": "jTFho_aymtN20pZR5RRSQAzd81I",\n  "token_type": "bearer",\n  "refresh_token": "H3SW6YFJ-tOPe0FQCM1Jd6VnMiA",\n  "expires_in": 2620978\n}\n')),(0,i.kt)("h3",{id:"\u5237\u65b0\u4ee5\u751f\u6210\u8bbf\u95ee\u4ee4\u724c"},"\u5237\u65b0\u4ee5\u751f\u6210\u8bbf\u95ee\u4ee4\u724c"),(0,i.kt)("p",null,"\u8bbf\u95ee\u4ee4\u724c\u6709\u6709\u6548\u671f\u9650 Once it expires, your app will have to use the ",(0,i.kt)("inlineCode",{parentName:"p"},"refresh token")," to request for a new ",(0,i.kt)("inlineCode",{parentName:"p"},"access token"),"."),(0,i.kt)("p",null,"\u4f7f\u7528\u7ed9\u5b9a\u7684\u53c2\u6570\u53d1\u51fa\u4ee5\u4e0b POST \u8bf7\u6c42\u4ee5\u83b7\u53d6\u65b0\u7684\u8bbf\u95ee\u4ee4\u724c\uff1a"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"https://api.adguard-dns.io/oapi/v1/oauth_token")),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"left"},"Parameter"),(0,i.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("strong",{parentName:"td"},"refresh_token")),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"REFRESH TOKEN")," using which a new access token has to be generated.")))),(0,i.kt)("h4",{id:"\u793a\u4f8b\u8bf7\u6c42-1"},"\u793a\u4f8b\u8bf7\u6c42"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"$ curl 'https://api.adguard-dns.io/oapi/v1/oauth_token' -i -X POST \\\n    -H 'Content-Type: application/x-www-form-urlencoded' \\\n    -d 'refresh_token=H3SW6YFJ-tOPe0FQCM1Jd6VnMiA'\n")),(0,i.kt)("h4",{id:"\u793a\u4f8b\u54cd\u5e94-1"},"\u793a\u4f8b\u54cd\u5e94"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "access_token": "xQnT7GYT6Ag--3oY_EcOOdXe-I0",\n  "token_type": "bearer",\n  "refresh_token": "H3SW6YFJ-tOPe0FQCM1Jd6VnMiA",\n  "expires_in": 2627999\n}\n')),(0,i.kt)("h3",{id:"\u79fb\u9664\u5237\u65b0\u4ee4\u724c"},"\u79fb\u9664\u5237\u65b0\u4ee4\u724c"),(0,i.kt)("p",null,"\u8981\u53d6\u6d88\u5237\u65b0\u8be5\u4ee4\u724c\uff0c\u8bf7\u4f7f\u7528\u7ed9\u5b9a\u53c2\u6570\u53d1\u51fa\u4ee5\u4e0b POST \u8bf7\u6c42\uff1a"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"https://api.adguard-dns.io/oapi/v1/revoke_token")),(0,i.kt)("h4",{id:"\u8bf7\u6c42\u793a\u4f8b"},"\u8bf7\u6c42\u793a\u4f8b"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"$ curl 'https://api.adguard-dns.com/oapi/v1/revoke_token' -i -X POST \\\n    -d 'token=H3SW6YFJ-tOPe0FQCM1Jd6VnMiA'\n")),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"left"},"Parameter"),(0,i.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("strong",{parentName:"td"},"refresh_token")),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"REFRESH TOKEN")," which is to be revoked")))),(0,i.kt)("h3",{id:"authorization-endpoint"},"Authorization endpoint"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"To access this endpoint, you need to contact us at ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("a",{parentName:"strong",href:"mailto:devteam@adguard.com"},"devteam@adguard.com")),". Please describe the reason and use cases for this endpoint, as well as provide the redirect URI. Upon approval, you will receive a unique client identifier, which should be used for the ",(0,i.kt)("strong",{parentName:"p"},"client_id")," parameter.")),(0,i.kt)("p",null,"The ",(0,i.kt)("strong",{parentName:"p"},"/oapi/v1/oauth_authorize")," endpoint is used to interact with the resource owner and get the authorization to access the protected resource."),(0,i.kt)("p",null,"The service redirects you to AdGuard to authenticate (if you are not already logged in) and then back to your application."),(0,i.kt)("p",null,"The request parameters of the ",(0,i.kt)("strong",{parentName:"p"},"/oapi/v1/oauth_authorize")," endpoint are:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"left"},"Parameter"),(0,i.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("strong",{parentName:"td"},"response_type")),(0,i.kt)("td",{parentName:"tr",align:"left"},"Tells the authorization server which grant to execute")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("strong",{parentName:"td"},"client_id")),(0,i.kt)("td",{parentName:"tr",align:"left"},"The ID of the OAuth client that asks for authorization")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("strong",{parentName:"td"},"redirect_uri")),(0,i.kt)("td",{parentName:"tr",align:"left"},"Contains a URL. A successful response from this endpoint results in a redirect to this URL")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("strong",{parentName:"td"},"state")),(0,i.kt)("td",{parentName:"tr",align:"left"},"An opaque value used for security purposes. If this request parameter is set in the request, it is returned to the application as part of the ",(0,i.kt)("strong",{parentName:"td"},"redirect_uri"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("strong",{parentName:"td"},"aid")),(0,i.kt)("td",{parentName:"tr",align:"left"},"Affiliate identifier")))),(0,i.kt)("p",null,"For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-http",metastring:"request",request:!0},"https://api.adguard-dns.io/oapi/v1/oauth_authorize?response_type=token&client_id=CLIENT_ID&redirect_uri=REDIRECT_URI&state=1jbmuc0m9WTr1T6dOO82\n")),(0,i.kt)("p",null,"To inform the authorization server which grant type to use, the ",(0,i.kt)("strong",{parentName:"p"},"response_type")," request parameter is used as follows:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"For the Implicit grant, use ",(0,i.kt)("strong",{parentName:"li"},"response_type=token")," to include an access token.")),(0,i.kt)("p",null,"A successful response is ",(0,i.kt)("strong",{parentName:"p"},"302 Found"),", which triggers a redirect to ",(0,i.kt)("strong",{parentName:"p"},"redirect_uri")," (which is a request parameter). The response parameters are embedded in the fragment component (the part after ",(0,i.kt)("inlineCode",{parentName:"p"},"#"),") of the ",(0,i.kt)("strong",{parentName:"p"},"redirect_uri")," parameter in the ",(0,i.kt)("strong",{parentName:"p"},"Location")," header."),(0,i.kt)("p",null,"For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-http",metastring:"request",request:!0},"HTTP/1.1 302 Found\nLocation: REDIRECT_URI#access_token=...&token_type=Bearer&expires_in=3600&state=1jbmuc0m9WTr1T6dOO82\n")),(0,i.kt)("h3",{id:"\u8bbf\u95eeapi"},"\u8bbf\u95eeAPI"),(0,i.kt)("p",null,"Once the access and the refresh tokens are generated, API calls can be made by passing the access token in the header."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\u6807\u5934\u540d\u79f0\u5e94\u4e3a ",(0,i.kt)("inlineCode",{parentName:"li"},"Authorization")),(0,i.kt)("li",{parentName:"ul"},"\u6807\u5934\u503c\u5e94\u4e3a ",(0,i.kt)("inlineCode",{parentName:"li"},"Bearer {access_token}"))),(0,i.kt)("h2",{id:"api"},"API"),(0,i.kt)("h3",{id:"reference"},"Reference"),(0,i.kt)("p",null,"Please see the methods reference ",(0,i.kt)("a",{parentName:"p",href:"/KnowledgeBaseDNS/zh-CN/private-dns/api/reference"},"here"),"."),(0,i.kt)("h3",{id:"\u5f00\u6e90api-\u89c4\u8303"},"\u5f00\u6e90API \u89c4\u8303"),(0,i.kt)("p",null,"OpenAPI \u89c4\u8303\u53ef\u5728 ",(0,i.kt)("a",{parentName:"p",href:"https://api.adguard-dns.io/static/swagger/openapi.json"},"https://api.adguard-dns.io/static/swagger/openapi.json"),"\u3002"),(0,i.kt)("p",null,"\u60a8\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u5de5\u5177\u6765\u67e5\u770b\u53ef\u7528 API \u65b9\u6cd5\u7684\u5217\u8868\u3002 For instance, you can open this file in ",(0,i.kt)("a",{parentName:"p",href:"https://editor.swagger.io/"},"https://editor.swagger.io/"),"."),(0,i.kt)("h3",{id:"changelog"},"Changelog"),(0,i.kt)("p",null,"The complete AdGuard DNS API changelog is available on ",(0,i.kt)("a",{parentName:"p",href:"/KnowledgeBaseDNS/zh-CN/private-dns/api/changelog"},"this page"),"."),(0,i.kt)("h2",{id:"feedback"},"Feedback"),(0,i.kt)("p",null,"If you would like this API to be extended with new methods, please email us to ",(0,i.kt)("inlineCode",{parentName:"p"},"devteam@adguard.com")," and let us know what you would like to be added."))}k.isMDXComponent=!0}}]);